<%- include('../partials/header') -%>

<div class="container" id="blog">
	<div class="box">
		<img src="<%= blog.image %>">
	</div>
	<h1><%= blog.title %></h1>
	<p>Posted by <%= blog.author.username %></p>
	<p>
		Created on <%= blog.created.toLocaleDateString("en-US", {
		weekday: "long", year: "numeric", month: "short", day: "numeric"}) %>
	</p>
	<p id="blog-body"><%= blog.body %></p>

	<p><strong>Comments:</strong></p>

	<% blog.comments.forEach(function(comment){ %>
		<div class="card">
			<p><strong><%= comment.author.username %>:</strong></p>
			<p><%= comment.text %></p>
			<form action="/blogs/<%= blog._id %>/comments/<%= comment._id %>/edit" method="GET">
				<button class="button">Edit</button>
			</form>

			<form action="/blogs/<%= blog._id %>/comments/<%= comment._id %>/delete" method="GET">
				<button class="button">Delete</button>
			</form>
		</div>
	<% }); %>
	
	<% if(currentUser && currentUser.isAdmin){ %>
	<form action="/blogs/<%= blog._id %>/edit" method="GET">
		<button class="button">Edit</button>
	</form>

	<form action="/blogs/<%= blog._id %>?_method=DELETE" method="POST">
		<button class="button">Delete Blog</button>
	</form>

	<% } %>
	<form action="/blogs/<%= blog._id %>/comments/new" method="GET">
		<button class="button">New Comment</button>
	</form>
</div>

<%- include('../partials/footer') -%>